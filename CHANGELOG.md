# 更新日志 (CHANGELOG)

所有重要的项目变更都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [1.1.10] - 2025-01-17

### 新增
- 重构DNS提供商接口，将`GetRecord`和`ListRecords`合并为统一的`GetRecords`方法
- 优化阿里云DNS提供商实现，修正API响应解析问题
- 增强错误处理和RecordId类型兼容性
- 基于Context的优雅服务终止机制

### 改进
- 清理调试代码，提供生产环境友好的输出
- 统一DNS记录获取逻辑，在DNSManager中本地查找指定记录
- 标记其他DNS供应商状态为"待验证"，等待后续测试完善
- 优化DNS查询性能：同一域名多条记录从N次API调用优化为1次API调用
- 服务关闭时间从25秒优化到5秒，支持强制退出

### 修复
- 修正阿里云DNS API响应结构解析错误
- 修复RecordId字段类型处理，支持字符串和数字格式
- 改进JSON解析错误处理

### 技术改进
- 采用Context取消机制替代传统信号处理
- 启动日志显示版本信息
- 5秒超时后自动强制退出(os.Exit(0))

### 计划中
- 完善其他DNS提供商的GetRecords实现
- Web管理界面
- 配置文件热重载

---

## [1.1.3] - 2024-09-15

### 新增
- 为DNS提供商接口添加`ListRecords`方法，支持列出域名下所有DNS记录
- 增强DNS测试功能，显示域名下所有现有记录
- 改进DNS测试报告格式，提供更详细的连接状态和错误分析

### 改进
- DNS凭证测试现在会先尝试列出域名记录以验证API连接
- 增强错误提示和故障排除建议
- 为阿里云DNS实现完整的`ListRecords`功能
- 其他DNS提供商添加占位实现，后续版本将完善

### 修复
- 改进DNS测试逻辑，记录不存在时不视为测试失败
- 优化测试输出格式，提供更清晰的状态反馈

---

## [1.1.2] - 2024-09-15

### 新增
- 添加DNS凭证测试功能，支持`--test-dns`命令行参数
- 优化systemd服务配置，添加超时设置和信号处理机制
- 改进程序信号处理，支持优雅退出(SIGTERM/SIGINT)
- 增强DNS调试日志，提供更详细的错误信息和操作状态

### 改进
- 优化systemd服务启动/停止时间，解决长时间等待问题
- 增强DNS提供商凭证验证和连接测试能力
- 改进日志输出格式，提供更清晰的操作反馈

### 修复
- 修复编译时缺失dns包import导致的构建错误

---

## [1.1.1] - 2024-09-15

### 修复
- 修复DNS提供商凭证设置问题，确保API调用时有正确的认证信息
- 修复二进制文件编译错误，现在正确生成Linux ELF可执行文件

### 技术改进
- 在DNS操作前动态设置提供商凭证
- 支持Cloudflare的Token认证方式
- 优化跨平台编译流程

---

## [1.1.0] - 2024-09-15

### 新增功能
- 🎨 **全面日志增强系统**
  - 启用颜色支持：成功(绿色🎉)、错误(红色❌)、警告(黄色⚠️)
  - 详细的DNS查询日志记录
  - 详细的文件更新日志记录
  - 文件输出时自动禁用颜色代码

- 🚀 **启动时立即执行功能**
  - 服务启动后立即执行一次IP检测和更新
  - 不需要等待第一个检查间隔

- 🔧 **配置文件问题修复**
  - 修复安装脚本配置文件创建逻辑
  - 创建标准的default-config.conf默认配置模板
  - 统一所有DNS记录TTL为600秒(10分钟)
  - 同步所有示例配置文件使用中国大陆可访问的IP检测服务

### 改进
- DNS和文件更新的醒目成功日志显示
- 重试操作的警告颜色标识
- 错误日志的突出显示
- 更清晰的中文日志信息

### 配置更新
- 所有示例配置文件更新为最新格式
- 添加`dns_check_interval`和`file_check_interval`配置项
- 更新IP检测端点为中国大陆可访问服务

---

## [1.0.3] - 2024-09-14

### 修复
- 修复关键问题并优化中国大陆使用体验
- 移除第一次运行检测和服务创建功能
- 将IP检测服务更换为中国大陆可访问的端点
- 实现DNS和文件更新的分离计时机制

### 配置变更
- DNS更新默认间隔：60分钟
- 文件更新默认间隔：10分钟
- IP检测端点更新为国内服务

---

## [1.0.2] - 2024-09-14

### 新增功能
- 🔍 **完整实现DNS记录查询与比对功能**
  - 为所有5个DNS提供商(阿里云、腾讯云、华为云、Cloudflare、GoDaddy)实现GetRecord方法
  - 更新前先查询当前记录值进行比对
  - 避免不必要的DNS更新操作

### 技术改进
- 新增DNS接口GetRecord方法
- 实现智能DNS记录比对逻辑
- 优化DNS更新流程

---

## [1.0.1] - 2024-09-14

### 新增功能
- 🎯 **实现PRD第4条功能改进**
  - IP格式检测和CIDR掩码保留功能
  - 文件操作原子写入，优化NFS环境兼容性
  - 更新前值比较，避免不必要的更新操作

### 技术改进
- 新增`processIPWithMask()`方法处理IP格式
- 实现`atomicWrite()`方法确保文件操作安全性
- 添加`GetCurrentValue()`方法支持所有配置文件格式
- 完成跨平台编译配置

### 构建系统
- 创建`build_linux.bat`自动化构建脚本
- 支持Windows到Linux的交叉编译

---

## [1.0.0] - 2024-09-14

### 🎉 初始版本发布

### 核心功能
- **多DNS提供商支持**: 阿里云、腾讯云、华为云、Cloudflare、GoDaddy
- **多格式配置文件更新**: JSON、YAML、TOML、INI
- **智能IP检测**: 多端点轮询，自动故障切换
- **灵活配置系统**: TOML格式配置文件，支持多域名多记录
- **重试机制**: 可配置的重试次数和间隔
- **日志系统**: 分级日志记录，支持文件和控制台输出
- **安全特性**: 敏感信息加密存储
- **系统集成**: systemd服务支持，自动安装脚本

### 部署支持
- Linux系统自动安装脚本
- systemd服务配置
- 完整的示例配置文件
- 详细的部署文档

### 配置示例
- 各DNS提供商的配置示例
- 文件更新配置示例
- 混合模式配置示例

---

## 版本命名规则

- **主版本号(Major)**: 重大架构变更或不兼容的API修改
- **次版本号(Minor)**: 新功能添加，向后兼容
- **修订号(Patch)**: Bug修复和小的改进

## 变更类型

- `新增` - 新功能
- `修复` - Bug修复
- `改进` - 现有功能的改进
- `移除` - 移除的功能
- `安全` - 安全相关的修复
- `废弃` - 即将移除的功能